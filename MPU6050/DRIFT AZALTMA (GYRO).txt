#include <Adafruit_MPU6050.h>
#include <Adafruit_Sensor.h>
#include <Wire.h>

float Gx;
float Gy;
float Gz;
 
float rollG=0;
float pitchG=0;
float yawG=0;
 
float gyroXOffset=0;
float gyroYOffset=0;
float gyroZOffset=0;
 
int tStart = millis();

float roll = 0;
 
float pitch = 0;

Adafruit_MPU6050 mpu;
 
void calibrateGyro(){
Serial.println("Jiroskop kalibre ediliyor. Lutfen sabit tutun");
delay(1000);
int i;
float sumX = 0;
float sumY = 0;
float sumZ = 0;
int numPoints=1000; // Alınan örnek sayısı
for (i=0;i<numPoints;i=i+1){
  sensors_event_t a, g, temp;
  mpu.getEvent(&a, &g, &temp);
  sumX = sumX + g.gyro.x;
  sumY = sumY + g.gyro.y;
  sumZ = sumZ + g.gyro.z;
  delay(10);
}

//Ortalama sapma bulunuyor
gyroXOffset = sumX/numPoints;
gyroYOffset = sumY/numPoints;
gyroZOffset = sumZ/numPoints;
 
}
 
void setup() {
  // put your setup code here, to run once:
  Serial.begin(115200);
  mpu.begin();
  Serial.println("MPU6050 Started!");
  mpu.setAccelerometerRange(MPU6050_RANGE_2_G);
  mpu.setGyroRange(MPU6050_RANGE_2000_DEG);
  mpu.setFilterBandwidth(MPU6050_BAND_21_HZ);
calibrateGyro();
tStart = millis();
}
 
void loop() {
  // put your main code here, to run repeatedly:
  sensors_event_t a, g, temp;
  mpu.getEvent(&a, &g, &temp);
 
// Gerçek değerler bulunuyor
  Gx = g.gyro.x-gyroXOffset;
  Gy = g.gyro.y-gyroYOffset;
  Gz = g.gyro.z-gyroZOffset;
 
rollG = rollG + (millis() - tStart)/1000. * Gy *360./2./3.14;
pitchG = pitchG + (millis() - tStart)/1000. * Gx *360./2./3.14;
yawG = yawG + (millis() - tStart)/1000. * Gz *360./2./3.14;
tStart = millis();
 
  Serial.print("Gx:");
  Serial.print(Gx);
  Serial.print(',');
  Serial.print("Gy:");
  Serial.print(Gy);
  Serial.print(',');
  Serial.print("Gz:");
  Serial.print(Gz);
  Serial.print(',');
  Serial.print("rollG:");
  Serial.print(rollG);
  Serial.print(',');
  Serial.print("pitchG:");
  Serial.print(pitchG);
  Serial.print(',');
  Serial.print("yawG:");
  Serial.print(yawG);
  Serial.print(',');
  Serial.print("UL:");
  Serial.print(90);
  Serial.print(',');
  Serial.print("LL:");
  Serial.println(-90);
 
 
  delay(1);
}